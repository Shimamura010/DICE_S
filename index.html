<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·éª°å­æ¦‚ç‡å®éªŒå¹³å°</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "å¾®è½¯é›…é»‘", "å¹¼åœ†", sans-serif;
        }
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 28px;
        }
        /* å‚æ•°è®¾ç½®åŒº */
        .setting-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .setting-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .setting-item label {
            font-size: 18px;
            color: #34495e;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .setting-item select, .setting-item input {
            padding: 10px 15px;
            font-size: 16px;
            border: 2px solid #3498db;
            border-radius: 8px;
            width: 150px;
            text-align: center;
        }
        .control-btn {
            padding: 12px 30px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 0 10px;
        }
        #startBtn {
            background-color: #2ecc71;
            color: white;
        }
        #resetBtn {
            background-color: #e74c3c;
            color: white;
        }
        /* éª°å­å±•ç¤ºåŒº */
        .dice-area {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            min-height: 200px;
        }
        .dice {
            width: 120px;
            height: 120px;
            border: 3px solid #2c3e50;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 48px;
            font-weight: bold;
            background-color: white;
            margin: 0 15px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
            transition: transform 0.5s ease;
        }
        .dice.rolling {
            transform: rotateY(360deg) rotateZ(360deg);
        }
        /* ç»“æœå±•ç¤ºåŒº */
        .result-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .data-table th, .data-table td {
            border: 2px solid #34495e;
            padding: 12px;
            text-align: center;
            font-size: 16px;
        }
        .data-table th {
            background-color: #3498db;
            color: white;
        }
        .chart-container {
            width: 100%;
            height: 400px;
        }
        /* åŠ è½½æç¤º */
        .loading {
            text-align: center;
            font-size: 20px;
            color: #3498db;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ² æ·éª°å­æ¦‚ç‡å®éªŒå¹³å° ğŸ²</h1>

        <!-- å‚æ•°è®¾ç½®åŒº -->
        <div class="setting-area">
            <div class="setting-item">
                <label>é€‰æ‹©éª°å­æ•°é‡</label>
                <select id="diceCount">
                    <option value="1">1ä¸ªéª°å­</option>
                    <option value="2">2ä¸ªéª°å­</option>
                </select>
            </div>
            <div class="setting-item">
                <label>é€‰æ‹©æŠ•æ·æ¬¡æ•°</label>
                <input type="number" id="rollCount" value="100" min="1" max="1000000" step="100">
            </div>
            <button class="control-btn" id="startBtn">å¼€å§‹å®éªŒ</button>
            <button class="control-btn" id="resetBtn">é‡ç½®å®éªŒ</button>
        </div>

        <!-- åŠ è½½æç¤º -->
        <div class="loading" id="loadingText">æ­£åœ¨è¿›è¡Œå®éªŒï¼Œè¯·ç¨å€™...</div>

        <!-- éª°å­å±•ç¤ºåŒº -->
        <div class="dice-area" id="diceArea">
            <div class="dice" id="dice1">1</div>
            <div class="dice" id="dice2" style="display: none;">1</div>
        </div>

        <!-- ç»“æœå±•ç¤ºåŒº -->
        <div class="result-area">
            <!-- æ•°æ®è¡¨æ ¼ -->
            <table class="data-table" id="resultTable">
                <thead>
                    <tr id="tableHeader">
                        <th>ç‚¹æ•°</th>
                        <th>å‡ºç°æ¬¡æ•°</th>
                        <th>å‡ºç°é¢‘ç‡</th>
                        <th>ç†è®ºæ¦‚ç‡</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- åŠ¨æ€ç”Ÿæˆæ•°æ®è¡Œ -->
                </tbody>
            </table>

            <!-- å¯è§†åŒ–å›¾è¡¨ -->
            <div class="chart-container">
                <canvas id="resultChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let diceCount = 1; // é»˜è®¤1ä¸ªéª°å­
        let rollCount = 100; // é»˜è®¤æŠ•æ·100æ¬¡
        let rollResults = {}; // å­˜å‚¨æŠ•æ·ç»“æœ
        let chart = null; // å›¾è¡¨å®ä¾‹

        // åˆå§‹åŒ–ç†è®ºæ¦‚ç‡ï¼ˆ1ä¸ªéª°å­/2ä¸ªéª°å­ï¼‰
        const theoryProb = {
            1: {1: 1/6, 2: 1/6, 3: 1/6, 4: 1/6, 5: 1/6, 6: 1/6},
            2: {
                2: 1/36, 3: 2/36, 4: 3/36, 5: 4/36, 6: 5/36,
                7: 6/36, 8: 5/36, 9: 4/36, 10: 3/36, 11: 2/36, 12: 1/36
            }
        };

        // åˆå§‹åŒ–é¡µé¢
        window.onload = function() {
            // ç»‘å®šäº‹ä»¶
            document.getElementById('diceCount').addEventListener('change', updateDiceCount);
            document.getElementById('rollCount').addEventListener('input', updateRollCount);
            document.getElementById('startBtn').addEventListener('click', startExperiment);
            document.getElementById('resetBtn').addEventListener('click', resetExperiment);

            // åˆå§‹åŒ–è¡¨æ ¼å’Œå›¾è¡¨
            initTable();
            initChart();
        };

        // æ›´æ–°éª°å­æ•°é‡
        function updateDiceCount() {
            diceCount = parseInt(document.getElementById('diceCount').value);
            const dice2 = document.getElementById('dice2');
            dice2.style.display = diceCount === 2 ? 'block' : 'none';
            resetExperiment(); // åˆ‡æ¢éª°å­æ•°é‡åé‡ç½®
        }

        // æ›´æ–°æŠ•æ·æ¬¡æ•°
        function updateRollCount() {
            rollCount = parseInt(document.getElementById('rollCount').value);
            // é™åˆ¶æœ€å¤§æ¬¡æ•°ä¸º1000000
            if (rollCount > 1000000) rollCount = 1000000;
            if (rollCount < 1) rollCount = 1;
            document.getElementById('rollCount').value = rollCount;
        }

        // åˆå§‹åŒ–è¡¨æ ¼
        function initTable() {
            const tableHeader = document.getElementById('tableHeader');
            const tableBody = document.getElementById('tableBody');
            tableHeader.innerHTML = '<th>ç‚¹æ•°</th><th>å‡ºç°æ¬¡æ•°</th><th>å‡ºç°é¢‘ç‡</th><th>ç†è®ºæ¦‚ç‡</th>';
            tableBody.innerHTML = '';

            // æ ¹æ®éª°å­æ•°é‡ç”Ÿæˆè¡¨æ ¼è¡Œ
            const points = diceCount === 1 ? [1,2,3,4,5,6] : [2,3,4,5,6,7,8,9,10,11,12];
            points.forEach(point => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${point}</td>
                    <td>0</td>
                    <td>0.000</td>
                    <td>${(theoryProb[diceCount][point]).toFixed(3)}</td>
                `;
                row.id = `row-${point}`;
                tableBody.appendChild(row);
            });

            // åˆå§‹åŒ–ç»“æœå­˜å‚¨
            rollResults = {};
            points.forEach(point => rollResults[point] = 0);
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            const ctx = document.getElementById('resultChart').getContext('2d');
            const points = diceCount === 1 ? [1,2,3,4,5,6] : [2,3,4,5,6,7,8,9,10,11,12];
            
            // é”€æ¯æ—§å›¾è¡¨
            if (chart) chart.destroy();

            // åˆ›å»ºæ–°å›¾è¡¨
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: points,
                    datasets: [
                        {
                            label: 'å®é™…å‡ºç°é¢‘ç‡',
                            data: points.map(p => 0),
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'ç†è®ºæ¦‚ç‡',
                            data: points.map(p => theoryProb[diceCount][p]),
                            backgroundColor: 'rgba(46, 204, 113, 0.7)',
                            borderColor: 'rgba(46, 204, 113, 1)',
                            borderWidth: 1,
                            type: 'line',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é¢‘ç‡/æ¦‚ç‡',
                                font: { size: 16 }
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(3);
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'ç‚¹æ•°',
                                font: { size: 16 }
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `æ·${diceCount}ä¸ªéª°å­-${rollCount}æ¬¡å®éªŒç»“æœ`,
                            font: { size: 20 }
                        },
                        legend: {
                            position: 'top',
                            font: { size: 14 }
                        }
                    }
                }
            });
        }

        // å¼€å§‹å®éªŒ
        async function startExperiment() {
            // ç¦ç”¨æŒ‰é’®ï¼Œæ˜¾ç¤ºåŠ è½½
            document.getElementById('startBtn').disabled = true;
            document.getElementById('loadingText').style.display = 'block';
            
            // é‡ç½®ç»“æœ
            resetExperiment(false);
            
            // æ¨¡æ‹Ÿéª°å­æŠ•æ·åŠ¨ç”»ï¼ˆå…ˆå±•ç¤ºå‡ æ¬¡æŠ•æ·æ•ˆæœï¼Œå†æ‰¹é‡è®¡ç®—å¤§æ•°ï¼‰
            const dice1 = document.getElementById('dice1');
            const dice2 = document.getElementById('dice2');
            
            // å…ˆå±•ç¤º10æ¬¡åŠ¨ç”»ï¼ˆç›´è§‚ï¼‰ï¼Œå†æ‰¹é‡è®¡ç®—å‰©ä½™æ¬¡æ•°
            const animateTimes = Math.min(10, rollCount);
            const batchTimes = rollCount - animateTimes;

            // åŠ¨ç”»æŠ•æ·
            for (let i = 0; i < animateTimes; i++) {
                // éª°å­æ»šåŠ¨åŠ¨ç”»
                dice1.classList.add('rolling');
                if (dice2.style.display !== 'none') dice2.classList.add('rolling');
                
                // éšæœºç”Ÿæˆç‚¹æ•°
                const p1 = Math.floor(Math.random() * 6) + 1;
                const p2 = diceCount === 2 ? Math.floor(Math.random() * 6) + 1 : 0;
                const total = diceCount === 1 ? p1 : p1 + p2;
                
                // å»¶è¿Ÿæ›´æ–°ç»“æœï¼ˆæ¨¡æ‹ŸæŠ•æ·æ—¶é—´ï¼‰
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // æ›´æ–°éª°å­æ˜¾ç¤º
                dice1.textContent = p1;
                if (dice2.style.display !== 'none') dice2.textContent = p2;
                dice1.classList.remove('rolling');
                if (dice2.style.display !== 'none') dice2.classList.remove('rolling');
                
                // ç»Ÿè®¡ç»“æœ
                rollResults[total]++;
                updateTableAndChart();
                
                // çŸ­å»¶è¿Ÿï¼Œè®©åŠ¨ç”»æ›´æµç•…
                await new Promise(resolve => setTimeout(resolve, 200));
            }

            // æ‰¹é‡è®¡ç®—å‰©ä½™æ¬¡æ•°ï¼ˆå¤§æ•°å¤„ç†ï¼Œæ— åŠ¨ç”»ï¼Œæé«˜æ•ˆç‡ï¼‰
            if (batchTimes > 0) {
                for (let i = 0; i < batchTimes; i++) {
                    const p1 = Math.floor(Math.random() * 6) + 1;
                    const p2 = diceCount === 2 ? Math.floor(Math.random() * 6) + 1 : 0;
                    const total = diceCount === 1 ? p1 : p1 + p2;
                    rollResults[total]++;
                    
                    // æ¯1000æ¬¡æ›´æ–°ä¸€æ¬¡è¡¨æ ¼å’Œå›¾è¡¨ï¼Œé¿å…å¡é¡¿
                    if (i % 1000 === 0) {
                        updateTableAndChart();
                        await new Promise(resolve => setTimeout(resolve, 10));
                    }
                }
            }

            // æœ€ç»ˆæ›´æ–°è¡¨æ ¼å’Œå›¾è¡¨
            updateTableAndChart();
            
            // å¯ç”¨æŒ‰é’®ï¼Œéšè—åŠ è½½
            document.getElementById('startBtn').disabled = false;
            document.getElementById('loadingText').style.display = 'none';
        }

        // æ›´æ–°è¡¨æ ¼å’Œå›¾è¡¨
        function updateTableAndChart() {
            const points = diceCount === 1 ? [1,2,3,4,5,6] : [2,3,4,5,6,7,8,9,10,11,12];
            
            // æ›´æ–°è¡¨æ ¼
            points.forEach(point => {
                const count = rollResults[point];
                const frequency = (count / rollCount).toFixed(3);
                const row = document.getElementById(`row-${point}`);
                row.children[1].textContent = count;
                row.children[2].textContent = frequency;
            });

            // æ›´æ–°å›¾è¡¨
            chart.data.datasets[0].data = points.map(p => rollResults[p] / rollCount);
            chart.data.datasets[1].data = points.map(p => theoryProb[diceCount][p]);
            chart.options.plugins.title.text = `æ·${diceCount}ä¸ªéª°å­-${rollCount}æ¬¡å®éªŒç»“æœ`;
            chart.update();
        }

        // é‡ç½®å®éªŒ
        function resetExperiment(init = true) {
            // é‡ç½®éª°å­æ˜¾ç¤º
            document.getElementById('dice1').textContent = 1;
            document.getElementById('dice2').textContent = 1;
            
            // åˆå§‹åŒ–è¡¨æ ¼å’Œå›¾è¡¨
            if (init) {
                initTable();
                initChart();
            } else {
                // ä»…é‡ç½®ç»“æœ
                const points = diceCount === 1 ? [1,2,3,4,5,6] : [2,3,4,5,6,7,8,9,10,11,12];
                points.forEach(point => rollResults[point] = 0);
                updateTableAndChart();
            }
        }
    </script>
</body>
</html>